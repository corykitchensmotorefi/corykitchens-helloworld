version: '1.0'

stages:
  - 'clone'
  - 'deployVercel'

steps:
  clone:
    title: 'Cloning repository'
    type: 'git-clone'
    repo: 'corykitchensmotorefi/corykitchens-helloworld'
    revision: 'main'
    stage: 'clone'

  install:
    title: 'Installing dependencies'
    type: 'freestyle'
    image: 'circleci/node:12.19.0'
    working_directory: '${{clone}}'
    commands:
      - 'npm config get cache'
      - 'CYPRESS_CACHE_FOLDER=$CF_VOLUME_PATH/cypress_install_cache npm ci'
    when:
      steps:
        - name: clone

  deployVercel:
    stage: 'deployVercel'
    type: 'freestyle'
    image: 'circleci/node:12.19.0'
    working_directory: '${{clone}}'
    commands:
      - 'npx vercel -d -t $VERCEL_TOKEN --prod'
    title: 'Deploy corykitchens-helloworld to Vercel'
    # environment:
    #   - VERCEL_PROJECT_ID=${{VERCEL_PROJECT_ID}}